<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Cli (mirage.Functoria.Cli)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">mirage</a> &#x00BB; <a href="../index.html">Functoria</a> &#x00BB; Cli</nav><header class="odoc-preamble"><h1>Module <code><span>Functoria.Cli</span></code></h1><p>Command-line handling.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#sub-commands">Sub-commands</a></li><li><a href="#evaluation">Evaluation</a></li></ul></nav></div><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-args"><a href="#type-args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a args</span></span><span> = </span><span>{</span></code><ol><li id="type-args.context" class="def record field anchored"><a href="#type-args.context" class="anchor"></a><code><span>context : <span class="type-var">'a</span>;</span></code></li><li id="type-args.config_file" class="def record field anchored"><a href="#type-args.config_file" class="anchor"></a><code><span>config_file : <span class="xref-unresolved">Fpath</span>.t;</span></code></li><li id="type-args.context_file" class="def record field anchored"><a href="#type-args.context_file" class="anchor"></a><code><span>context_file : <span><span class="xref-unresolved">Fpath</span>.t option</span>;</span></code></li><li id="type-args.output" class="def record field anchored"><a href="#type-args.output" class="anchor"></a><code><span>output : <span>string option</span>;</span></code></li><li id="type-args.dry_run" class="def record field anchored"><a href="#type-args.dry_run" class="anchor"></a><code><span>dry_run : bool;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type for global arguments.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_args"><a href="#val-default_args" class="anchor"></a><code><span><span class="keyword">val</span> default_args : <span>unit <a href="#type-args">args</a></span></span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peek_args"><a href="#val-peek_args" class="anchor"></a><code><span><span class="keyword">val</span> peek_args : 
  <span><span class="optlabel">?with_setup</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">mname</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>unit <a href="#type-args">args</a></span> option</span></span></code></div><div class="spec-doc"><p><code>peek_args ?with_setup argv</code> parses the global command-line arguments. If <code>with_setup</code> is set (by default it is), interprets <code>-v</code> and <code>--color</code> to set-up the terminal configuration as a side-effect. Returns None if global command-line arguments are invalid.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peek_output"><a href="#val-peek_output" class="anchor"></a><code><span><span class="keyword">val</span> peek_output : <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>string option</span></span></code></div><div class="spec-doc"><p><code>peek_full_eval argv</code> reads the <code>--output</code> option from <code>argv</code>; the return value is <code>None</code> if option is absent in <code>argv</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_args"><a href="#val-pp_args" class="anchor"></a><code><span><span class="keyword">val</span> pp_args : <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Fmt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-args">args</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_args</code> is the pretty-printer for args.</p></div></div><h2 id="sub-commands"><a href="#sub-commands" class="anchor"></a>Sub-commands</h2><div class="odoc-spec"><div class="spec type anchored" id="type-configure_args"><a href="#type-configure_args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a configure_args</span></span><span> = </span><span>{</span></code><ol><li id="type-configure_args.args" class="def record field anchored"><a href="#type-configure_args.args" class="anchor"></a><code><span>args : <span><span class="type-var">'a</span> <a href="#type-args">args</a></span>;</span></code></li><li id="type-configure_args.depext" class="def record field anchored"><a href="#type-configure_args.depext" class="anchor"></a><code><span>depext : bool;</span></code></li><li id="type-configure_args.extra_repo" class="def record field anchored"><a href="#type-configure_args.extra_repo" class="anchor"></a><code><span>extra_repo : <span><span>(string * string)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type for arguments of the <code>configure</code> sub-command.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-build_args"><a href="#type-build_args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a build_args</span></span><span> = <span><span class="type-var">'a</span> <a href="#type-args">args</a></span></span></code></div><div class="spec-doc"><p>The type for arguments of the <code>build</code> sub-command.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-clean_args"><a href="#type-clean_args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a clean_args</span></span><span> = <span><span class="type-var">'a</span> <a href="#type-args">args</a></span></span></code></div><div class="spec-doc"><p>The type for arguments of the <code>clean</code> sub-command.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-help_args"><a href="#type-help_args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a help_args</span></span><span> = <span><span class="type-var">'a</span> <a href="#type-args">args</a></span></span></code></div><div class="spec-doc"><p>The type for arguments of the <code>help</code> sub-command.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-query_kind"><a href="#type-query_kind" class="anchor"></a><code><span><span class="keyword">type</span> query_kind</span><span> = </span><span>[ </span></code><ol><li id="type-query_kind.Name" class="def variant constructor anchored"><a href="#type-query_kind.Name" class="anchor"></a><code><span>| </span><span>`Name</span></code></li><li id="type-query_kind.Packages" class="def variant constructor anchored"><a href="#type-query_kind.Packages" class="anchor"></a><code><span>| </span><span>`Packages</span></code></li><li id="type-query_kind.Opam" class="def variant constructor anchored"><a href="#type-query_kind.Opam" class="anchor"></a><code><span>| </span><span>`Opam</span></code></li><li id="type-query_kind.Files" class="def variant constructor anchored"><a href="#type-query_kind.Files" class="anchor"></a><code><span>| </span><span>`Files</span></code></li><li id="type-query_kind.Dune" class="def variant constructor anchored"><a href="#type-query_kind.Dune" class="anchor"></a><code><span>| </span><span>`Dune <span class="keyword">of</span> <span>[ `Config <span>| `Build</span> <span>| `Project</span> <span>| `Workspace</span> <span>| `Dist</span> ]</span></span></code></li><li id="type-query_kind.Makefile" class="def variant constructor anchored"><a href="#type-query_kind.Makefile" class="anchor"></a><code><span>| </span><span>`Makefile</span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_query_kind"><a href="#val-pp_query_kind" class="anchor"></a><code><span><span class="keyword">val</span> pp_query_kind : <span><a href="#type-query_kind">query_kind</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_query_kind</code> is the pretty-printer for query kinds.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-query_args"><a href="#type-query_args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a query_args</span></span><span> = </span><span>{</span></code><ol><li id="type-query_args.args" class="def record field anchored"><a href="#type-query_args.args" class="anchor"></a><code><span>args : <span><span class="type-var">'a</span> <a href="#type-args">args</a></span>;</span></code></li><li id="type-query_args.kind" class="def record field anchored"><a href="#type-query_args.kind" class="anchor"></a><code><span>kind : <a href="#type-query_kind">query_kind</a>;</span></code></li><li id="type-query_args.depext" class="def record field anchored"><a href="#type-query_args.depext" class="anchor"></a><code><span>depext : bool;</span></code></li><li id="type-query_args.extra_repo" class="def record field anchored"><a href="#type-query_args.extra_repo" class="anchor"></a><code><span>extra_repo : <span><span>(string * string)</span> list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type for arguments of the <code>query</code> sub-command.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-describe_args"><a href="#type-describe_args" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a describe_args</span></span><span> = </span><span>{</span></code><ol><li id="type-describe_args.args" class="def record field anchored"><a href="#type-describe_args.args" class="anchor"></a><code><span>args : <span><span class="type-var">'a</span> <a href="#type-args">args</a></span>;</span></code></li><li id="type-describe_args.dotcmd" class="def record field anchored"><a href="#type-describe_args.dotcmd" class="anchor"></a><code><span>dotcmd : string;</span></code></li><li id="type-describe_args.dot" class="def record field anchored"><a href="#type-describe_args.dot" class="anchor"></a><code><span>dot : bool;</span></code></li><li id="type-describe_args.eval" class="def record field anchored"><a href="#type-describe_args.eval" class="anchor"></a><code><span>eval : <span>bool option</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type for arguments of the <code>describe</code> sub-command.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peek_full_eval"><a href="#val-peek_full_eval" class="anchor"></a><code><span><span class="keyword">val</span> peek_full_eval : <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>bool option</span></span></code></div><div class="spec-doc"><p><code>peek_full_eval argv</code> reads the <code>--eval</code> option from <code>argv</code>; the return value is <code>None</code> if option is absent in <code>argv</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-action"><a href="#type-action" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a action</span></span><span> = </span></code><ol><li id="type-action.Configure" class="def variant constructor anchored"><a href="#type-action.Configure" class="anchor"></a><code><span>| </span><span><span class="constructor">Configure</span> <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-configure_args">configure_args</a></span></span></code></li><li id="type-action.Query" class="def variant constructor anchored"><a href="#type-action.Query" class="anchor"></a><code><span>| </span><span><span class="constructor">Query</span> <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-query_args">query_args</a></span></span></code></li><li id="type-action.Describe" class="def variant constructor anchored"><a href="#type-action.Describe" class="anchor"></a><code><span>| </span><span><span class="constructor">Describe</span> <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-describe_args">describe_args</a></span></span></code></li><li id="type-action.Clean" class="def variant constructor anchored"><a href="#type-action.Clean" class="anchor"></a><code><span>| </span><span><span class="constructor">Clean</span> <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-clean_args">clean_args</a></span></span></code></li><li id="type-action.Help" class="def variant constructor anchored"><a href="#type-action.Help" class="anchor"></a><code><span>| </span><span><span class="constructor">Help</span> <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-help_args">help_args</a></span></span></code></li></ol></div><div class="spec-doc"><p>A value of type <code>action</code> is the result of parsing command-line arguments using <code>parse_args</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_action"><a href="#val-pp_action" class="anchor"></a><code><span><span class="keyword">val</span> pp_action : <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Fmt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-action">action</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_action</code> is the pretty-printer for actions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-args"><a href="#val-args" class="anchor"></a><code><span><span class="keyword">val</span> args : <span><span><span class="type-var">'a</span> <a href="#type-action">action</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-args">args</a></span></span></code></div><div class="spec-doc"><p><code>args a</code> are <code>a</code>'s global arguments.</p></div></div><h2 id="evaluation"><a href="#evaluation" class="anchor"></a>Evaluation</h2><div class="odoc-spec"><div class="spec value anchored" id="val-eval"><a href="#val-eval" class="anchor"></a><code><span><span class="keyword">val</span> eval : 
  <span><span class="optlabel">?with_setup</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?help_ppf</span>:<span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?err_ppf</span>:<span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">name</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">version</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">configure</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Cmdliner</span>.Term.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">query</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Cmdliner</span>.Term.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">describe</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Cmdliner</span>.Term.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">clean</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Cmdliner</span>.Term.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">help</span>:<span><span class="type-var">'a</span> <span class="xref-unresolved">Cmdliner</span>.Term.t</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">mname</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span>
  <span>[ <span>`Ok of <span><span class="type-var">'a</span> <a href="#type-action">action</a></span></span> <span><span>| `Error</span> of <span>[ `Parse <span>| `Term</span> <span>| `Exn</span> ]</span></span> <span>| `Version</span> <span>| `Help</span> ]</span></span></code></div><div class="spec-doc"><p>Parse the functoria command line. The arguments to <code>~configure</code>, <code>~describe</code>, etc., describe extra command-line arguments that should be accepted by the corresponding subcommands.</p><p>There are no side effects, save for the printing of usage messages and other help when either the 'help' subcommand or no subcommand is specified.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-result"><a href="#type-result" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a result</span></span><span> = </span><span>[ </span></code><ol><li id="type-result.Ok" class="def variant constructor anchored"><a href="#type-result.Ok" class="anchor"></a><code><span>| </span><span>`Ok <span class="keyword">of</span> <span><span class="type-var">'a</span> <a href="#type-action">action</a></span></span></code></li><li id="type-result.Error" class="def variant constructor anchored"><a href="#type-result.Error" class="anchor"></a><code><span>| </span><span>`Error <span class="keyword">of</span> <span><span><span class="type-var">'a</span> <a href="#type-args">args</a></span> option</span> * <span>[ `Exn <span>| `Parse</span> <span>| `Term</span> ]</span></span></code></li><li id="type-result.Version" class="def variant constructor anchored"><a href="#type-result.Version" class="anchor"></a><code><span>| </span><span>`Version</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>Similar to <code>Cmdliner.Term.result</code> but help is folded into <code>`Ok</code> and errors also carry global command-line parameters.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-peek"><a href="#val-peek" class="anchor"></a><code><span><span class="keyword">val</span> peek : <span><span class="optlabel">?with_setup</span>:bool <span class="arrow">&#45;&gt;</span></span> <span><span class="label">mname</span>:string <span class="arrow">&#45;&gt;</span></span> <span><span>string array</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-result">result</a></span></span></code></div><div class="spec-doc"><p><code>peek</code> is the same as <a href="#val-eval"><code>eval</code></a> but without failing on unknown arguments.</p></div></div></div></body></html>
