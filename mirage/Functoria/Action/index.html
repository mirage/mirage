<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Action (mirage.Functoria.Action)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">mirage</a> &#x00BB; <a href="../index.html">Functoria</a> &#x00BB; Action</nav><header class="odoc-preamble"><h1>Module <code><span>Functoria.Action</span></code></h1><p>Wrapper around <code>Bos</code> which provides a &quot;dry run&quot; feature.</p></header><nav class="odoc-toc"><ul><li><a href="#the-action-type">The action type</a></li><li><a href="#actions">Actions</a></li><li><a href="#interpreters">Interpreters</a></li></ul></nav><div class="odoc-content"><h2 id="the-action-type"><a href="#the-action-type" class="anchor"></a>The action type</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>An action that when executed may return a value of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ok"><a href="#val-ok" class="anchor"></a><code><span><span class="keyword">val</span> ok : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>An action that returns a value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-error"><a href="#val-error" class="anchor"></a><code><span><span class="keyword">val</span> error : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>error e</code> is the failed action with error message <code>e</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-errorf"><a href="#val-errorf" class="anchor"></a><code><span><span class="keyword">val</span> errorf : <span><span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Stdlib</span>.Format.formatter, unit, <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="xref-unresolved">Stdlib</span>.format4</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>errorf fmt</code> is the failed action with error message <code>fmt</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Functor instance.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span class="label">f</span>:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Monad instance.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-seq"><a href="#val-seq" class="anchor"></a><code><span><span class="keyword">val</span> seq : <span><span><span>unit <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>seq t</code> runs the elements of <code>t</code> in sequence.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-List"><a href="#module-List" class="anchor"></a><code><span><span class="keyword">module</span> <a href="List/index.html">List</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Infix"><a href="#module-Infix" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Infix/index.html">Infix</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Syntax"><a href="#module-Syntax" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Syntax/index.html">Syntax</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h2 id="actions"><a href="#actions" class="anchor"></a>Actions</h2><div class="odoc-spec"><div class="spec value anchored" id="val-rm"><a href="#val-rm" class="anchor"></a><code><span><span class="keyword">val</span> rm : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Delete a file. (see <code>Bos.OS.File.delete</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-mkdir"><a href="#val-mkdir" class="anchor"></a><code><span><span class="keyword">val</span> mkdir : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Create a directory. (See <code>Bos.OS.Dir.create</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-rmdir"><a href="#val-rmdir" class="anchor"></a><code><span><span class="keyword">val</span> rmdir : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Remove a directory. (see <code>Bos.OS.Dir.delete</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_dir"><a href="#val-with_dir" class="anchor"></a><code><span><span class="keyword">val</span> with_dir : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span>(<span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>with_dir d f</code> runs <code>f</code> with <code>d</code> as current working directory. (See <code>Bos.OS.Dir.with_current</code>).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pwd"><a href="#val-pwd" class="anchor"></a><code><span><span class="keyword">val</span> pwd : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Fpath</span>.t <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>pwd ()</code> is the current working directory. (See <code>Bos.OS.Dir.current</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_file"><a href="#val-is_file" class="anchor"></a><code><span><span class="keyword">val</span> is_file : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Does a file exist? (see <code>Bos.OS.File.exists</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_dir"><a href="#val-is_dir" class="anchor"></a><code><span><span class="keyword">val</span> is_dir : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Does a directory exist? (see <code>Bos.OS.Dir.exists</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-size_of"><a href="#val-size_of" class="anchor"></a><code><span><span class="keyword">val</span> size_of : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span>int option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>size_of f</code> is <code>Some i</code> if <code>f</code> exists and is of size <code>i</code>, and <code>None</code> if <code>f</code> doesn't exist.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set_var"><a href="#val-set_var" class="anchor"></a><code><span><span class="keyword">val</span> set_var : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>set_var v c</code> sets env variable <code>c</code> to <code>c</code>. (see <code>Bos.OS.Env.set_var</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_var"><a href="#val-get_var" class="anchor"></a><code><span><span class="keyword">val</span> get_var : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>get_var v</code> gets the value of the variable <code>c</code> in the environment. (see <code>Bos.OS.Env.get</code>)</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-channel"><a href="#type-channel" class="anchor"></a><code><span><span class="keyword">type</span> channel</span><span> = </span><span>[ </span></code><ol><li id="type-channel.Null" class="def variant constructor anchored"><a href="#type-channel.Null" class="anchor"></a><code><span>| </span><span>`Null</span></code></li><li id="type-channel.Fmt" class="def variant constructor anchored"><a href="#type-channel.Fmt" class="anchor"></a><code><span>| </span><span>`Fmt <span class="keyword">of</span> <span class="xref-unresolved">Stdlib</span>.Format.formatter</span></code></li></ol><code><span> ]</span></code></div><div class="spec-doc"><p>The type for channels.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_cmd"><a href="#val-run_cmd" class="anchor"></a><code><span><span class="keyword">val</span> run_cmd : <span><span class="optlabel">?err</span>:<a href="#type-channel">channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?out</span>:<a href="#type-channel">channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Bos</span>.Cmd.t <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Run a command. By default, <code>err</code> is <code>Fmt.stderr</code> and <code>out</code> is <code>Fmt.stdout</code>. (see <code>Bos.OS.Cmd.run</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_cmd_out"><a href="#val-run_cmd_out" class="anchor"></a><code><span><span class="keyword">val</span> run_cmd_out : <span><span class="optlabel">?err</span>:<a href="#type-channel">channel</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Bos</span>.Cmd.t <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Run a command and return its trimmed stdout. By default <code>err</code> is <code>Fmt.stderr</code>. (See <code>Bos.OS.Cmd.run_out</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run_cmd_cli"><a href="#val-run_cmd_cli" class="anchor"></a><code><span><span class="keyword">val</span> run_cmd_cli : <span><span class="xref-unresolved">Bos</span>.Cmd.t <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Run a command as a command line interface, meaning stdout and stderr remain untouched.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_file"><a href="#val-write_file" class="anchor"></a><code><span><span class="keyword">val</span> write_file : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Write some data to a file. (see <code>Bos.OS.File.write</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_file"><a href="#val-read_file" class="anchor"></a><code><span><span class="keyword">val</span> read_file : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>read_file f</code> is <code>f</code>'s contents. (see <code>Bos.OS.File.read</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tmp_file"><a href="#val-tmp_file" class="anchor"></a><code><span><span class="keyword">val</span> tmp_file : <span><span class="optlabel">?mode</span>:int <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Bos</span>.OS.File.tmp_name_pat <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Fpath</span>.t <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>tmp_file pat</code> is a tempory file built using the pattern <code>pat</code>. (See <code>Bos.OS.File.tmp</code>)</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ls"><a href="#val-ls" class="anchor"></a><code><span><span class="keyword">val</span> ls : <span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Fpath</span>.t list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>ls dir</code> is the list of files in <code>dir</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_output"><a href="#val-with_output" class="anchor"></a><code><span><span class="keyword">val</span> with_output : 
  <span><span class="optlabel">?mode</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?append</span>:bool <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">path</span>:<span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">purpose</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span class="xref-unresolved">Stdlib</span>.Format.formatter <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Open a file with a given mode, and write some data to it through a function. (see <code>Bos.OS.File.with_oc</code>). <code>purpose</code> is used in error messages. If <code>append</code> is set (by default it is not), the data is appended to <code>path</code>.</p></div></div><h2 id="interpreters"><a href="#interpreters" class="anchor"></a>Interpreters</h2><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Rresult</span>.R.msg)</span> <span class="xref-unresolved">Stdlib</span>.result</span></span></code></div><div class="spec-doc"><p>Run the command through <code>Bos</code>.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-env"><a href="#type-env" class="anchor"></a><code><span><span class="keyword">type</span> env</span></code></div><div class="spec-doc"><p>The type for virtual environments.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-files"><a href="#type-files" class="anchor"></a><code><span><span class="keyword">type</span> files</span><span> = </span><span>[ </span></code><ol><li id="type-files.Passtrough" class="def variant constructor anchored"><a href="#type-files.Passtrough" class="anchor"></a><code><span>| </span><span>`Passtrough <span class="keyword">of</span> <span class="xref-unresolved">Fpath</span>.t</span></code></li><li id="type-files.Files" class="def variant constructor anchored"><a href="#type-files.Files" class="anchor"></a><code><span>| </span><span>`Files <span class="keyword">of</span> <span><span>(<span class="xref-unresolved">Fpath</span>.t * string)</span> list</span></span></code></li></ol><code><span> ]</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-default_exec"><a href="#val-default_exec" class="anchor"></a><code><span><span class="keyword">val</span> default_exec : <span><span class="xref-unresolved">Bos</span>.Cmd.t <span class="arrow">&#45;&gt;</span></span> <span><span>(string * string)</span> option</span></span></code></div><div class="spec-doc"><p><code>default_exec cmd</code> is <code>Some (&quot;$(&lt;cmd&gt;)&quot;, &quot;&quot;)</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-env"><a href="#val-env" class="anchor"></a><code><span><span class="keyword">val</span> env : 
  <span><span class="optlabel">?exec</span>:<span>(<span><span class="xref-unresolved">Bos</span>.Cmd.t <span class="arrow">&#45;&gt;</span></span> <span><span>(string * string)</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?env</span>:<span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?pwd</span>:<span class="xref-unresolved">Fpath</span>.t <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?files</span>:<a href="#type-files">files</a> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <a href="#type-env">env</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-domain"><a href="#type-domain" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a domain</span></span><span> = </span><span>{</span></code><ol><li id="type-domain.result" class="def record field anchored"><a href="#type-domain.result" class="anchor"></a><code><span>result : <span><span>(<span class="type-var">'a</span>, <span class="xref-unresolved">Rresult</span>.R.msg)</span> <span class="xref-unresolved">Stdlib</span>.result</span>;</span></code></li><li id="type-domain.env" class="def record field anchored"><a href="#type-domain.env" class="anchor"></a><code><span>env : <a href="#type-env">env</a>;</span></code></li><li id="type-domain.logs" class="def record field anchored"><a href="#type-domain.logs" class="anchor"></a><code><span>logs : <span>string list</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>The type for interpreted values.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-eq_domain"><a href="#val-eq_domain" class="anchor"></a><code><span><span class="keyword">val</span> eq_domain : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-domain">domain</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-domain">domain</a></span> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>eq_domain</code> is the equality function between <a href="#type-domain"><code>domain</code></a>s.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_domain"><a href="#val-pp_domain" class="anchor"></a><code><span><span class="keyword">val</span> pp_domain : <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Fmt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-domain">domain</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp_domain</code> is the pretty-printer for <a href="#type-domain"><code>domain</code></a>s.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dry_run"><a href="#val-dry_run" class="anchor"></a><code><span><span class="keyword">val</span> dry_run : <span><span class="optlabel">?env</span>:<a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-domain">domain</a></span></span></code></div><div class="spec-doc"><p>Emulate the action. This will not do IO on the actual files. Some approximation is done to determine the result of actions. <code>files</code> is a list of paths that are supposed to exist at the beginning. Returns:</p><ul><li>the result of the action (which can be an <code>Bos</code> error)</li><li>the list of files after execution</li><li>a trace (list of log messages)</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dry_run_trace"><a href="#val-dry_run_trace" class="anchor"></a><code><span><span class="keyword">val</span> dry_run_trace : <span><span class="optlabel">?env</span>:<a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Only output the trace part of <code>dry_run</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-generated_files"><a href="#val-generated_files" class="anchor"></a><code><span><span class="keyword">val</span> generated_files : <span><span class="optlabel">?env</span>:<a href="#type-env">env</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Fpath</span>.Set.t</span></code></div><div class="spec-doc"><p><code>generated_files t</code> is the set of files created by <code>t</code>. Note: this might be incomplete/incorrect in case of calls to external commands.</p></div></div></div></body></html>
